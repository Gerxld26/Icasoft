{% extends 'dashboard/base_dashboard.html' %}
{% load static %}
{% block title %}Gestión de Productos{% endblock %}
{% block content %}
<div class="main-container mx-4" id="read_product">
    <h2 class="mb-4">Gestión de Productos</h2>
    <div class="addSearch">
        <div class="contentSearchTech w-50">
            <div>
                <form method="get" action="" class="d-flex mb-3">
                    <input type="text" name="q" placeholder="Buscar producto..." value="{{ query|default:'' }}"
                        class="form-control inputSearch">
                    <button type="submit" class="searchTech">
                        <i class="fa-solid fa-magnifying-glass"></i>
                    </button>
                </form>
            </div>

            <div>
                <form method="GET" class="d-flex me-2">
                    <select name="categoria" class="form-select me-2">
                        <option value="">Todas las categorías</option>
                        {% for categoria in categorias %}
                        <option value="{{ categoria.idCategoria }}" {% if categoria.idCategoria|stringformat:"s" == categoria_seleccionada %}selected{% endif %}>
                            {{ categoria.nombreCategoria }}
                        </option>
                        {% endfor %}
                    </select>
                    <button type="submit" class="btn btn-outline-primary">Filtrar</button>
                </form>
            </div>
        </div>
        <div class="contentAddTech">
            <button type="button" id="btnAddProduct" class="btn btn-sm accionTecnicoAdd px-2" data-bs-toggle="modal"
                data-bs-target="#addProductModal" data-bs-title="Agregar">
                <i id="newProduct" class="fa-solid fa-user-plus"></i> Agregar
        </div>
    </div>

    <table class="table table-hover">
        <thead>
            <tr>
                <th>Nombre</th>
                <th>Categoría</th>
                <th>Stock</th>
                <th>Precio Venta</th>
                <th>Estado</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for producto in productos %}
            <tr>
                <td>{{ producto.nombreProducto }}</td>
                <td>{{ producto.idCategoria.nombreCategoria }}</td>
                <td>{{ producto.stock }}</td>
                <td>S/ {{ producto.precioVenta }}</td>
                <td>
                    {% if producto.estadoProducto %}
                    <span class="badge bg-success">Activo</span>
                    {% else %}
                    <span class="badge bg-danger">Inactivo</span>
                    {% endif %}
                </td>
                <td>
                    <button type="button" class="btn btn-sm accionTecnico px-2" data-bs-toggle="tooltip"
                        data-bs-placement="top" data-bs-title="Editar"
                        onclick="editProduct('{{ producto.idProducto }}')">
                        <i id="editProduct" class="bi bi-pencil-square iaccionTecnico"></i>
                    </button>
                    <button type="button" class="btn btn-sm accionTecnico px-2" data-bs-toggle="tooltip"
                        data-bs-placement="top" data-bs-title="Eliminar"
                        onclick="deleteProduct('{{ producto.idProducto }}')">
                        <i id="deleteProduct" class="bi bi-trash3-fill iaccionTecnico"></i>
                    </button>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="6" class="text-center">No hay categorías disponibles</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    {% if productos.has_other_pages %}
    <nav aria-label="Page navigation">
        <ul class="pagination justify-content-center">
            {% if productos.has_previous %}
            <li class="page-item">
                <a class="page-link"
                    href="?page=1{% if query %}&q={{ query }}{% endif %}{% if categoria_seleccionada %}&categoria={{ categoria_seleccionada }}{% endif %}"
                    aria-label="First">
                    <span aria-hidden="true">&laquo;&laquo;</span>
                </a>
            </li>
            <li class="page-item">
                <a class="page-link"
                    href="?page={{ productos.previous_page_number }}{% if query %}&q={{ query }}{% endif %}{% if categoria_seleccionada %}&categoria={{ categoria_seleccionada }}{% endif %}"
                    aria-label="Previous">
                    <span aria-hidden="true">&laquo;</span>
                </a>
            </li>
            {% endif %}

            {% for num in productos.paginator.page_range %}
            {% if productos.number == num %}
            <li class="page-item active"><a class="page-link" href="#">{{ num }}</a></li>
            {% elif num > productos.number|add:'-3' and num < productos.number|add:'3' %} <li class="page-item">
                <a class="page-link"
                    href="?page={{ num }}{% if query %}&q={{ query }}{% endif %}{% if categoria_seleccionada %}&categoria={{ categoria_seleccionada }}{% endif %}">{{
                    num }}</a></li>
                {% endif %}
                {% endfor %}

                {% if productos.has_next %}
                <li class="page-item">
                    <a class="page-link"
                        href="?page={{ productos.next_page_number }}{% if query %}&q={{ query }}{% endif %}{% if categoria_seleccionada %}&categoria={{ categoria_seleccionada }}{% endif %}"
                        aria-label="Next">
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
                <li class="page-item">
                    <a class="page-link"
                        href="?page={{ productos.paginator.num_pages }}{% if query %}&q={{ query }}{% endif %}{% if categoria_seleccionada %}&categoria={{ categoria_seleccionada }}{% endif %}"
                        aria-label="Last">
                        <span aria-hidden="true">&raquo;&raquo;</span>
                    </a>
                </li>
                {% endif %}
        </ul>
    </nav>
    {% endif %}
</div>
{% include "dashboard/admin/product/crud_product.html" %}
{% endblock %}